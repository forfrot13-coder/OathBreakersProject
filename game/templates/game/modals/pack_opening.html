<div x-show="openingModal" x-cloak class="fixed inset-0 z-[70] bg-black/95 flex flex-col items-center justify-center p-4">
    
    <!-- Stage 1: Shaking (Loading) -->
    <div x-show="animationStage === 'shaking'" 
         x-transition:enter="transition ease-out duration-300" 
         class="text-center animate-shake">
        <div class="text-6xl mb-4 drop-shadow-[0_0_15px_rgba(168,85,247,0.8)]">ðŸ”®</div>
        <div class="text-purple-300 font-bold animate-pulse">
            <span x-show="cardsQueue.length > 0" x-text="'Ú©Ø§Ø±Øª ' + (currentCardIndex + 1) + ' Ø§Ø² ' + cardsQueue.length"></span>
            <span x-show="cardsQueue.length === 0">Ø¯Ø± Ø­Ø§Ù„ Ú¯Ø´ÙˆØ¯Ù†...</span>
        </div>
    </div>

    <!-- Stage 2: Card Reveal -->
    <div x-show="animationStage === 'flipped'" class="flex flex-col items-center gap-6">
        
        <!-- Ú©Ø§Ø±Øª -->
        <div class="perspective-1000 w-64 h-80">
            <div class="relative w-full h-full transform-style-3d animate-[flipIn_0.6s_ease-out]">
                <div class="absolute w-full h-full backface-hidden rounded-xl overflow-hidden border-2 border-white/20 bg-gray-900 flex flex-col shadow-2xl" 
                     :class="'glow-' + (openedCard ? openedCard.rarity : 'COMMON')">
                    
                    <template x-if="openedCard">
                        <div class="h-full flex flex-col">
                            <div class="flex-1 relative">
                                <img :src="openedCard.image" class="w-full h-full object-cover">
                                <div class="absolute bottom-0 w-full bg-gradient-to-t from-black to-transparent p-4 pt-10">
                                    <h3 class="text-xl font-bold text-white text-center" x-text="openedCard.card_name"></h3>
                                </div>
                            </div>
                            <div class="p-4 bg-gray-800 text-center">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-xs text-gray-400">Ú©Ù…ÛŒØ§Ø¨ÛŒ</span>
                                    <span class="text-xs font-bold px-2 py-0.5 rounded" 
                                          :class="{'bg-gray-600': openedCard.rarity==='COMMON', 'bg-blue-600': openedCard.rarity==='RARE', 'bg-purple-600': openedCard.rarity==='EPIC', 'bg-yellow-600': openedCard.rarity==='LEGENDARY'}" 
                                          x-text="openedCard.rarity"></span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-gray-400">Ù‚Ø¯Ø±Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬</span>
                                    <span class="font-mono text-green-400 font-bold" x-text="'+' + openedCard.mining_rate"></span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø¹Ø¯ÛŒ -->
        <button @click="currentCardIndex < cardsQueue.length ? nextCard() : closeOpeningModal()"
                class="bg-white text-black px-8 py-3 rounded-full font-bold hover:bg-gray-200 transition-transform active:scale-95 shadow-[0_0_20px_rgba(255,255,255,0.3)]">
            <span x-show="currentCardIndex < cardsQueue.length">Ú©Ø§Ø±Øª Ø¨Ø¹Ø¯ÛŒ âž”</span>
            <span x-show="currentCardIndex >= cardsQueue.length">ØªÙ…Ø§Ù… Ø´Ø¯ âœ“</span>
        </button>
        
        <div class="text-gray-500 text-xs">
            <span x-text="currentCardIndex"></span> / <span x-text="cardsQueue.length"></span>
        </div>
    </div>
</div>
