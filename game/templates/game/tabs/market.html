{% load static %}

<div x-show="currentTab === 'market'" x-cloak x-transition.opacity.duration.300ms>
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-purple-400">فروشگاه پک‌ها</h2>
        <button @click="fetchPacks()" class="text-xs bg-gray-800 px-3 py-1 rounded-full border border-gray-600 hover:bg-gray-700 btn-3d">
            بروزرسانی
        </button>
    </div>

    <div class="grid grid-cols-2 gap-4">
        <template x-for="pack in packList" :key="pack.id">
            <div class="relative group">

                <div @click="openPack(pack.id)"
                    class="pack-hover-3d bg-gradient-to-br from-gray-900 to-black border border-purple-800 rounded-2xl p-4 pt-8 text-center cursor-pointer hover:border-purple-500 active:scale-95 transition-all duration-200 overflow-hidden shadow-lg h-full flex flex-col justify-between">

                    <div class="h-20 mb-2 flex items-center justify-center">
                        <template x-if="pack.image">
                            <img :src="pack.image"
                                class="w-full h-full object-contain drop-shadow-md group-hover:scale-110 transition-transform duration-300">
                        </template>
                        <template x-if="!pack.image">
                            <span class="text-5xl drop-shadow-lg float-3d">🔮</span>
                        </template>
                    </div>

                    <div>
                        <div class="font-bold text-white text-sm mb-2 truncate" x-text="pack.name"></div>

                        <div class="flex items-center justify-center gap-1.5 bg-gray-800/80 rounded-lg py-1 px-2 mx-auto w-fit">
                            <span class="font-bold text-white text-sm" x-text="pack.price"></span>

                            <template x-if="pack.currency_type === 'GEMS'">
                                <img src="{% static 'game/images/icon_gem.png' %}" class="w-4 h-4 float-3d">
                            </template>
                            <template x-if="pack.currency_type === 'COINS'">
                                <img src="{% static 'game/images/icon_coin.png' %}" class="w-4 h-4 float-3d">
                            </template>
                        </div>
                    </div>
                </div>

                <div x-data="{ showInfo: false }" class="absolute top-2 right-2 z-10">
                    <button @click.stop="showInfo = !showInfo"
                        class="text-gray-400 hover:text-white transition-colors p-1 rounded-full hover:bg-white/10">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </button>

                    <div x-show="showInfo" @click.away="showInfo = false"
                        x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 scale-90"
                        x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-100"
                        x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-90"
                        class="absolute top-8 right-0 w-48 bg-gray-800 border border-gray-600 rounded-lg shadow-xl p-3 z-20 text-right">

                        <h4 class="text-xs font-bold text-purple-300 mb-1">محتویات پک:</h4>
                        <p class="text-xs text-gray-200 leading-relaxed" x-text="pack.description || 'توضیحات ندارد.'"></p>

                        <template x-if="pack.drop_rates">
                            <div class="mt-2 pt-2 border-t border-gray-700">
                                <p class="text-[10px] text-gray-400" x-text="pack.drop_rates"></p>
                            </div>
                        </template>
                    </div>
                </div>

            </div>
        </template>

        <div x-show="packList.length === 0" x-cloak class="col-span-2 py-10 text-center text-gray-500">
            هنوز پکی موجود نیست.
        </div>
    </div>
</div>
